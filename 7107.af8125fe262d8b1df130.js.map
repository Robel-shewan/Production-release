{"version":3,"file":"7107.af8125fe262d8b1df130.js","mappings":"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","sources":["webpack://mattermost-webapp/./src/components/dnd_custom_time_picker_modal/dnd_custom_time_picker_modal.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport classNames from 'classnames';\nimport {DateTime} from 'luxon';\nimport React from 'react';\nimport type {DayPickerProps} from 'react-day-picker';\nimport {FormattedMessage} from 'react-intl';\n\nimport IconButton from '@mattermost/compass-components/components/icon-button'; // eslint-disable-line no-restricted-imports\nimport {GenericModal} from '@mattermost/components';\nimport type {UserStatus} from '@mattermost/types/users';\n\nimport type {Theme} from 'mattermost-redux/selectors/entities/preferences';\n\nimport CompassThemeProvider from 'components/compass_theme_provider/compass_theme_provider';\nimport DatePicker from 'components/date_picker';\nimport Input from 'components/widgets/inputs/input/input';\nimport Menu from 'components/widgets/menu/menu';\nimport MenuWrapper from 'components/widgets/menu/menu_wrapper';\n\nimport Constants, {A11yCustomEventTypes, UserStatuses} from 'utils/constants';\nimport type {A11yFocusEventDetail} from 'utils/constants';\nimport {toUTCUnix} from 'utils/datetime';\nimport {isKeyPressed} from 'utils/keyboard';\nimport {localizeMessage} from 'utils/utils';\n\nimport './dnd_custom_time_picker_modal.scss';\n\ntype Props = {\n    onExited: () => void;\n    userId: string;\n    currentDate: Date;\n    locale: string;\n\n    theme: Theme;\n    actions: {\n        setStatus: (status: UserStatus) => void;\n    };\n};\n\ntype State = {\n    selectedDate: Date;\n    selectedTime: string;\n    timeMenuList: string[];\n    dayPickerStartDate: Date;\n    isPopperOpen: boolean;\n    popperElement: HTMLDivElement | null;\n}\n\nexport default class DndCustomTimePicker extends React.PureComponent<Props, State> {\n    private buttonRef = React.createRef<HTMLButtonElement>();\n    constructor(props: Props) {\n        super(props);\n\n        const {currentDate} = this.props;\n        const selectedDate: Date = new Date(currentDate);\n\n        // if current time is > 23:20 then we will set date to tomorrow and show all times\n        if (currentDate.getHours() === 23 && currentDate.getMinutes() > 20) {\n            selectedDate.setDate(currentDate.getDate() + 1);\n        }\n\n        this.state = {\n            selectedDate,\n            dayPickerStartDate: selectedDate,\n            ...this.makeTimeMenuList(selectedDate),\n            isPopperOpen: false,\n            popperElement: null,\n        };\n    }\n\n    componentDidMount() {\n        document.addEventListener('keydown', this.handleKeyDown);\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener('keydown', this.handleKeyDown);\n    }\n\n    handleKeyDown = (event: KeyboardEvent) => {\n        if (isKeyPressed(event, Constants.KeyCodes.ESCAPE)) {\n            if (this.state.isPopperOpen) {\n                this.handlePopperOpenState(false);\n            } else {\n                this.props.onExited();\n            }\n        }\n    };\n\n    formatDate = (date: Date): string => {\n        return DateTime.fromJSDate(date).toFormat('yyyy-MM-dd');\n    };\n\n    getText = () => {\n        const modalHeaderText = (\n            <FormattedMessage\n                id='dnd_custom_time_picker_modal.defaultMsg'\n                defaultMessage='Disable notifications until'\n            />\n        );\n        const confirmButtonText = (\n            <FormattedMessage\n                id='dnd_custom_time_picker_modal.submitButton'\n                defaultMessage='Disable Notifications'\n            />\n        );\n\n        return {\n            modalHeaderText,\n            confirmButtonText,\n        };\n    };\n\n    handleConfirm = async () => {\n        if (this.state.isPopperOpen) {\n            return;\n        }\n        const hours = parseInt(this.state.selectedTime.split(':')[0], 10);\n        const minutes = parseInt(this.state.selectedTime.split(':')[1], 10);\n        const endTime = new Date(this.state.selectedDate);\n        endTime.setHours(hours, minutes);\n        if (endTime < new Date()) {\n            return;\n        }\n        await this.props.actions.setStatus({\n            user_id: this.props.userId,\n            status: UserStatuses.DND,\n            dnd_end_time: toUTCUnix(endTime),\n            manual: true,\n            last_activity_at: toUTCUnix(this.props.currentDate),\n        });\n        this.props.onExited();\n    };\n\n    handleDaySelection = (day: Date) => {\n        this.setState({\n            isPopperOpen: false,\n            selectedDate: day,\n            ...this.makeTimeMenuList(day),\n        });\n    };\n\n    makeTimeMenuList = (date: Date): {timeMenuList: string[]; selectedTime: string} => {\n        const timeMenuItems = [];\n        let h = 0;\n        let m = 0;\n        const curr = this.props.currentDate;\n\n        if (this.formatDate(curr) === this.formatDate(date)) {\n            h = curr.getHours();\n            m = curr.getMinutes();\n            if (m > 20) {\n                h++;\n                m = 0;\n            } else {\n                m = 30;\n            }\n        }\n\n        for (let i = h; i < 24; i++) {\n            for (let j = m / 30; j < 2; j++) {\n                const t = i.toString().padStart(2, '0') + ':' + (j * 30).toString().padStart(2, '0');\n                timeMenuItems.push(\n                    t,\n                );\n            }\n        }\n\n        return {\n            timeMenuList: timeMenuItems,\n            selectedTime: timeMenuItems[0],\n        };\n    };\n\n    handlePopperOpenState = (isOpen: boolean) => {\n        this.setState({\n            isPopperOpen: isOpen,\n        });\n    };\n\n    render() {\n        const {\n            modalHeaderText,\n            confirmButtonText,\n        } = this.getText();\n\n        const {timeMenuList, selectedTime, selectedDate, dayPickerStartDate, isPopperOpen} = this.state;\n        const timeMenuItems = timeMenuList.map((time) => {\n            return (\n                <Menu.ItemAction\n                    id={`dndTime_dropdown_${time}`}\n                    key={time}\n                    text={time}\n                    ariaLabel={`${time} hours`}\n                    onClick={() => {\n                        this.setState({\n                            selectedTime: time,\n                        });\n                        document.dispatchEvent(new CustomEvent<A11yFocusEventDetail>(\n                            A11yCustomEventTypes.FOCUS, {\n                                detail: {\n                                    target: this.buttonRef.current,\n                                    keyboardOnly: true,\n                                },\n                            },\n                        ));\n                    }}\n                >\n                    {time}\n                </Menu.ItemAction>\n            );\n        });\n\n        const inputIcon = (\n            <IconButton\n                icon={'calendar-outline'}\n                onClick={() => this.handlePopperOpenState(true)}\n                className='dateTime__calendar-icon'\n                size={'sm'}\n                aria-haspopup='grid'\n            />\n        );\n\n        const dayPickerProps: DayPickerProps = {\n            initialFocus: isPopperOpen,\n            mode: 'single',\n            selected: selectedDate,\n            onDayClick: this.handleDaySelection,\n            disabled: [{\n                before: dayPickerStartDate,\n            }],\n            showOutsideDays: true,\n        };\n\n        return (\n            <CompassThemeProvider theme={this.props.theme}>\n                <GenericModal\n                    compassDesign={true}\n                    ariaLabel={localizeMessage('dnd_custom_time_picker_modal.defaultMsg', 'Disable notifications until')}\n                    onExited={this.props.onExited}\n                    modalHeaderText={modalHeaderText}\n                    confirmButtonText={confirmButtonText}\n                    handleConfirm={this.handleConfirm}\n                    handleEnterKeyPress={this.handleConfirm}\n                    id='dndCustomTimePickerModal'\n                    className={'DndModal modal-overflow'}\n                    tabIndex={-1}\n                    keyboardEscape={false}\n                >\n                    <div className='DndModal__content'>\n                        <DatePicker\n                            isPopperOpen={isPopperOpen}\n                            handlePopperOpenState={this.handlePopperOpenState}\n                            locale={this.props.locale}\n                            datePickerProps={dayPickerProps}\n                        >\n                            <Input\n                                value={this.formatDate(selectedDate)}\n                                readOnly={true}\n                                id='DndModal__calendar-input'\n                                className={classNames('DndModal__calendar-input', {'popper-open': isPopperOpen})}\n                                label={localizeMessage('dnd_custom_time_picker_modal.date', 'Date')}\n                                onClick={() => this.handlePopperOpenState(true)}\n                                tabIndex={-1}\n                                inputPrefix={inputIcon}\n                            />\n                        </DatePicker>\n                        <MenuWrapper\n                            id='dropdown-no-caret'\n                            stopPropagationOnToggle={true}\n                        >\n                            <button\n                                className='DndModal__input'\n                                type='button'\n                                ref={this.buttonRef}\n                            >\n                                <div className='DndModal__input__label'>\n                                    <FormattedMessage\n                                        id='dnd_custom_time_picker_modal.time'\n                                        defaultMessage='Time'\n                                    />\n                                </div>\n                                <i className='icon icon--no-spacing icon-clock-outline icon--xs icon-14'/>\n                                <span>{selectedTime}</span>\n                            </button>\n                            <Menu\n                                openLeft={false}\n                                ariaLabel={'Clear custom status after'}\n                            >\n                                {timeMenuItems}\n                            </Menu>\n                        </MenuWrapper>\n                    </div>\n                </GenericModal>\n            </CompassThemeProvider>\n        );\n    }\n}\n"],"names":["DndCustomTimePicker","React","constructor","props","super","_defineProperty","event","isKeyPressed","Constants","this","state","isPopperOpen","handlePopperOpenState","onExited","date","DateTime","toFormat","modalHeaderText","FormattedMessage","id","defaultMessage","confirmButtonText","async","hours","parseInt","selectedTime","split","minutes","endTime","Date","selectedDate","setHours","actions","setStatus","user_id","userId","status","UserStatuses","dnd_end_time","toUTCUnix","manual","last_activity_at","currentDate","day","setState","_objectSpread","makeTimeMenuList","timeMenuItems","h","m","curr","formatDate","getHours","getMinutes","i","j","t","toString","padStart","push","timeMenuList","isOpen","setDate","getDate","dayPickerStartDate","popperElement","componentDidMount","document","addEventListener","handleKeyDown","componentWillUnmount","removeEventListener","render","getText","map","time","Menu","concat","key","text","ariaLabel","onClick","dispatchEvent","CustomEvent","A11yCustomEventTypes","detail","target","buttonRef","current","keyboardOnly","inputIcon","IconButton","icon","className","size","dayPickerProps","initialFocus","mode","selected","onDayClick","handleDaySelection","disabled","before","showOutsideDays","CompassThemeProvider","theme","GenericModal","compassDesign","localizeMessage","handleConfirm","handleEnterKeyPress","tabIndex","keyboardEscape","DatePicker","locale","datePickerProps","Input","value","readOnly","classNames","label","inputPrefix","MenuWrapper","stopPropagationOnToggle","type","ref","openLeft","_pt","isRequired"],"sourceRoot":""}