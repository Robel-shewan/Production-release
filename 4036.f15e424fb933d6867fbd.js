"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[4036],{24036:(e,t,s)=>{s.r(t),s.d(t,{default:()=>oe}),s(52077),s(83526);var r=s(70314),a=s(36891),n=s(73443),i=s(31435),o=s(19601),l=s(11298),c=s(23894),u=s(20827),d=s(63970),m=s(98876),h=s(57235),p=s(23615),f=s.n(p),g=(s(14078),s(48410),s(61418),s(92189),s(66726)),v=s.n(g),b=s(84390),y=s.n(b),_=s(11313),P=s(72060),E=s(8243),M=s(23712),S=(s(69217),s(4500)),C=s(43618),R=s(39875),T=s(33115),w=s(40364),O=s(57449),I=s(78892),U=s(61057),j=s(60042),D=s.n(j),q=s(52576),x=s(80139),N=s(46299),F=s(44967),L=s(56859),k=s(90186),G=s(70174);function H(e){const{currentUserId:t,option:s,status:r}=e,{id:a,delete_at:n,is_bot:i=!1,last_picture_update:o}=s,l=(0,G.bj)(s);let c=l;return s.id===t?c=y().createElement(P.FormattedMessage,{id:"more_direct_channels.directchannel.you",defaultMessage:"{displayname} (you)",values:{displayname:l}}):s.delete_at&&(c=y().createElement(P.FormattedMessage,{id:"more_direct_channels.directchannel.deactivated",defaultMessage:"{displayname} - Deactivated",values:{displayname:l}})),y().createElement(y().Fragment,null,y().createElement(F.Z,{src:x.je.getProfilePictureUrl(a,o),status:n||i?void 0:r,size:"md"}),y().createElement("div",{className:"more-modal__details"},y().createElement("div",{className:"more-modal__name"},c,i&&y().createElement(L.Z,null),(0,T.nJ)(s.roles)&&y().createElement(k.Z,null),y().createElement(N.Z,{userID:s.id,showTooltip:!0,emojiSize:15,spanStyle:{display:"flex",flex:"0 0 auto",alignItems:"center"}})),!i&&y().createElement("div",{className:"more-modal__description"},s.email)))}H.propTypes={currentUserId:f().string.isRequired,status:f().string.isRequired};const V=(0,r.connect)((function(e,t){return{currentUserId:(0,c.rc)(e),status:(0,c.ZO)(e,t.option.id)}}))(H);function A(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Z(e){return"G"===(null==e?void 0:e.type)}function B(e){return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?A(Object(s),!0).forEach((function(t){var r,a,n;r=e,a=t,n=s[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(a))in r?Object.defineProperty(r,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[a]=n})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):A(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({value:e.id,label:Z(e)?e.display_name:e.username},e)}const Y={useTime:!1,style:"long",ranges:[{within:["minute",-1],display:["second",0]},{within:["hour",-1],display:["minute"]},{within:["hour",-24],display:["hour"]},{within:["day",-30],display:["day"]},{within:["month",-11],display:["month"]},{within:["year",-1e3],display:["year"]}]},z=y().forwardRef(((e,t)=>{const{option:s,isMobileView:r,isSelected:a,add:n,select:i}=e,{last_post_at:o}=s;let l;l=Z(s)?y().createElement(X,{option:s}):y().createElement(V,{option:s});const c=(0,b.useCallback)((()=>n(s)),[s,n]),u=(0,b.useCallback)((()=>i(s)),[s,i]);return y().createElement("div",{ref:t,className:D()("more-modal__row clickable",{"more-modal__row--selected":a}),onClick:c,onMouseEnter:u},l,r&&Boolean(o)&&y().createElement("div",{className:"more-modal__lastPostAt"},y().createElement(q.ZP,Object.assign({},Y,{value:o}))),y().createElement("div",{className:"more-modal__actions"},y().createElement("div",{className:"more-modal__actions--round"},y().createElement("i",{className:"icon icon-plus"}))))}));z.propTypes={isMobileView:f().bool.isRequired,isSelected:f().bool.isRequired,add:f().func.isRequired,select:f().func.isRequired},z.displayName="ListItem";const W=z;function X(e){const{option:t}=e;return y().createElement(y().Fragment,null,y().createElement("div",{className:"more-modal__gm-icon"},t.profiles.length),y().createElement("div",{className:"more-modal__details"},y().createElement("div",{className:"more-modal__name"},y().createElement("span",null,t.profiles.map((e=>"@".concat(e.username))).join(", ")))))}const J=(0,r.connect)((function(e){return{isMobileView:(0,U.E7)(e)}}))(W),K=M.default.MAX_USERS_IN_GM-1,Q=y().forwardRef(((e,t)=>{const s=(0,b.useCallback)(((t,s,r,a)=>y().createElement(J,{ref:s?e.selectedItemRef:void 0,key:"more_direct_channels_list_"+t.value,option:t,isSelected:s,add:r,select:a})),[e.selectedItemRef]),a=(0,r.useDispatch)(),n=(0,b.useCallback)((t=>t.id===e.currentUserId||Boolean(t.delete_at)),[e.currentUserId]),i=(0,P.useIntl)();let o,l;e.isExistingChannel&&(o=e.values.length>=K?y().createElement(P.FormattedMessage,{id:"more_direct_channels.new_convo_note.full",defaultMessage:"You've reached the maximum number of people for this conversation. Consider creating a private channel instead."}):y().createElement(P.FormattedMessage,{id:"more_direct_channels.new_convo_note",defaultMessage:"This will start a new conversation. If you're adding a lot of people, consider creating a private channel instead."})),l=K>e.values.length?y().createElement(P.FormattedMessage,{id:"multiselect.numPeopleRemaining",defaultMessage:"Use ↑↓ to browse, ↵ to select. You can add upto 30 more {num, plural, one {person} other {people}}. ",values:{num:K-e.values.length}}):y().createElement(P.FormattedMessage,{id:"multiselect.maxPeople",defaultMessage:"Use ↑↓ to browse, ↵ to select. You can't add more than {num} people. Please <a>create a channel</a> to include more people.",values:{num:K,a:t=>y().createElement("a",{href:"#",onClick:t=>(t=>{t.preventDefault(),e.handleHide(),a((0,w.h)({modalId:M.r8.NEW_CHANNEL_MODAL,dialogType:I.default}))})(t)},t)}});const c=(0,b.useMemo)((()=>e.options.map(B)),[e.options]);return y().createElement(O.Z,{ref:t,options:c,optionRenderer:s,intl:i,selectedItemRef:e.selectedItemRef,values:e.values,valueRenderer:ee,ariaLabelRenderer:te,perPage:50,handlePageChange:e.handlePageChange,handleInput:e.search,handleDelete:e.handleDelete,handleAdd:e.addValue,handleSubmit:e.handleSubmit,noteText:o,maxValues:K,numRemainingText:l,buttonSubmitText:y().createElement(P.FormattedMessage,{id:"multiselect.go",defaultMessage:"Go"}),buttonSubmitLoadingText:y().createElement(P.FormattedMessage,{id:"multiselect.loading",defaultMessage:"Loading..."}),submitImmediatelyOn:n,saving:e.saving,loading:e.loading,users:e.users,totalCount:e.totalCount,placeholderText:i.formatMessage({id:"multiselect.placeholder",defaultMessage:"Search and add members"})})}));Q.propTypes={addValue:f().func.isRequired,currentUserId:f().string.isRequired,handleDelete:f().func.isRequired,handlePageChange:f().func.isRequired,handleSubmit:f().func.isRequired,handleHide:f().func.isRequired,isExistingChannel:f().bool.isRequired,loading:f().bool.isRequired,options:f().array.isRequired,saving:f().bool.isRequired,search:f().func.isRequired,totalCount:f().number.isRequired,users:f().array.isRequired,values:f().array.isRequired};const $=Q;function ee(e){return e.data.username}function te(e){var t;return null!==(t=null==e?void 0:e.username)&&void 0!==t?t:""}function se(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function re(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?se(Object(s),!0).forEach((function(t){var r,a,n;r=e,a=t,n=s[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(a))in r?Object.defineProperty(r,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[a]=n})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):se(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const ae=(0,r.connect)((function(){const e=function(){const e=(0,S.P1)("getUsersWithDMs",c.rc,C.IU,((e,t)=>t),((e,t,s)=>{const r=Object.values(t).filter((e=>e.type===M.default.DM_CHANNEL)),a=[];for(const t of r){const r=(0,R.aU)(e,t.name),n=s.find((e=>e.id===r));n&&0!==t.last_post_at&&a.push(re(re({},n),{},{last_post_at:t.last_post_at}))}return a})),t=(0,S.P1)("getFilteredGroupChannels",C.P6,(e=>e.views.search.modalSearch),((e,t)=>t),((e,t,s)=>e.filter((e=>(!t||0!==(0,T.vI)(e.profiles,t).length)&&!(s&&!s.every((t=>e.profiles.find((e=>e.id===t.id)))))&&e.last_post_at>0))));return(0,S.P1)("makeGetOptions",e,((e,s,r)=>t(e,r)),((e,t)=>t),(e=>Boolean(e.views.search.modalSearch)),((e,t,s,r)=>{const a=[...e,...t].sort(((e,t)=>t.last_post_at-e.last_post_at));if(!r&&a.length>0)return a.slice(0,20);const n=s.filter((t=>0===t.delete_at&&!e.some((e=>e.id===t.id)))).map((e=>re(re({},e),{},{last_post_at:0})));return n.sort(((e,t)=>e.username.localeCompare(t.username))),[...a,...n]}))}();return(t,s)=>({options:e(t,s.users,s.values)})}))($);function ne(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ie extends y().PureComponent{constructor(e){var t;super(e),t=this,ne(this,"loadModalData",(()=>{this.getUserProfiles(),this.props.actions.getTotalUsersStats(),this.props.actions.loadProfilesMissingStatus(this.props.users)})),ne(this,"handleHide",(()=>{this.props.actions.setModalSearchTerm(""),this.setState({show:!1})})),ne(this,"setUsersLoadingState",(e=>{this.setState({loadingUsers:e})})),ne(this,"handleExit",(()=>{var e,t,s,r;this.exitToChannel&&(0,E.s)().push(this.exitToChannel),null===(e=(t=this.props).onModalDismissed)||void 0===e||e.call(t),null===(s=(r=this.props).onExited)||void 0===s||s.call(r)})),ne(this,"handleSubmit",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.state.values;const{actions:s}=t.props;if(t.state.saving)return;const r=e.map((e=>e.id));if(0===r.length)return;t.setState({saving:!0});const a=e=>{const{data:s,error:r}=e;t.setState({saving:!1}),r||(t.exitToChannel="/"+t.props.currentTeamName+"/channels/"+s.name,t.handleHide())};1===r.length?s.openDirectChannelToUserId(r[0]).then(a):s.openGroupChannelToUserIds(r).then(a)})),ne(this,"addValue",(e=>{if(Z(e))this.addUsers(e.profiles);else{const t=Object.assign([],this.state.values);-1===t.indexOf(e)&&t.push(e),this.setState({values:t})}})),ne(this,"addUsers",(e=>{const t=Object.assign([],this.state.values),s=t.map((e=>e.id));for(const r of e)-1===s.indexOf(r.id)&&t.push(B(r));this.setState({values:t})})),ne(this,"getUserProfiles",(e=>{const t=e?e+1:0;"any"===this.props.restrictDirectMessage?this.props.actions.getProfiles(t,100).then((()=>{this.setUsersLoadingState(!1)})):this.props.actions.getProfilesInTeam(this.props.currentTeamId||"",t,100).then((()=>{this.setUsersLoadingState(!1)}))})),ne(this,"handlePageChange",((e,t)=>{e>t&&(this.setUsersLoadingState(!0),this.getUserProfiles(e))})),ne(this,"resetPaging",(()=>{var e;null===(e=this.multiselect.current)||void 0===e||e.resetPaging()})),ne(this,"search",v()((e=>{this.props.actions.setModalSearchTerm(e)}),250)),ne(this,"handleDelete",(e=>{this.setState({values:e})})),this.searchTimeoutId=0,this.multiselect=y().createRef(),this.selectedItemRef=y().createRef();const s=[];if(e.currentChannelMembers)for(let t=0;t<e.currentChannelMembers.length;t++){const r=Object.assign({},e.currentChannelMembers[t]);r.id!==e.currentUserId&&s.push(B(r))}this.state={values:s,show:!0,search:!1,saving:!1,loadingUsers:!0}}updateFromProps(e){if(e.searchTerm!==this.props.searchTerm){clearTimeout(this.searchTimeoutId);const e=this.props.searchTerm;if(""===e)this.resetPaging();else{const t="any"===this.props.restrictDirectMessage?"":this.props.currentTeamId;this.searchTimeoutId=setTimeout((async()=>{this.setUsersLoadingState(!0);const[{data:s},{data:r}]=await Promise.all([this.props.actions.searchProfiles(e,{team_id:t}),this.props.actions.searchGroupChannels(e)]);s&&this.props.actions.loadStatusesForProfilesList(s),r&&this.props.actions.loadProfilesForGroupChannels(r),this.resetPaging(),this.setUsersLoadingState(!1)}),M.default.SEARCH_TIMEOUT_MILLISECONDS)}}e.users.length!==this.props.users.length&&this.props.actions.loadProfilesMissingStatus(this.props.users)}componentDidUpdate(e){this.updateFromProps(e)}render(){const e=y().createElement(ae,{addValue:this.addValue,currentUserId:this.props.currentUserId,handleDelete:this.handleDelete,handlePageChange:this.handlePageChange,handleSubmit:this.handleSubmit,handleHide:this.handleHide,isExistingChannel:this.props.isExistingChannel,loading:this.state.loadingUsers,saving:this.state.saving,search:this.search,selectedItemRef:this.selectedItemRef,totalCount:this.props.totalCount,users:this.props.users,values:this.state.values});return y().createElement(_.Modal,{dialogClassName:"a11y__modal more-modal more-direct-channels",show:this.state.show,onHide:this.handleHide,onExited:this.handleExit,onEntered:this.loadModalData,role:"dialog","aria-labelledby":"moreDmModalLabel",id:"moreDmModal"},y().createElement(_.Modal.Header,{closeButton:!0},y().createElement(_.Modal.Title,{componentClass:"h1",id:"moreDmModalLabel"},y().createElement(P.FormattedMessage,{id:"more_direct_channels.title",defaultMessage:"Direct Messages"}))),y().createElement(_.Modal.Body,{role:"application"},e),y().createElement(_.Modal.Footer,{className:"modal-footer--invisible"},y().createElement("button",{id:"closeModalButton",type:"button",className:"btn btn-tertiary"},y().createElement(P.FormattedMessage,{id:"general_button.close",defaultMessage:"Close"}))))}}ne(ie,"propTypes",{currentUserId:f().string.isRequired,currentTeamId:f().string,currentTeamName:f().string,searchTerm:f().string.isRequired,users:f().array.isRequired,totalCount:f().number.isRequired,currentChannelMembers:f().array,isExistingChannel:f().bool.isRequired,restrictDirectMessage:f().string,onModalDismissed:f().func,onExited:f().func,actions:f().shape({getProfiles:f().func.isRequired,getProfilesInTeam:f().func.isRequired,loadProfilesMissingStatus:f().func.isRequired,getTotalUsersStats:f().func.isRequired,loadStatusesForProfilesList:f().func.isRequired,loadProfilesForGroupChannels:f().func.isRequired,openDirectChannelToUserId:f().func.isRequired,openGroupChannelToUserIds:f().func.isRequired,searchProfiles:f().func.isRequired,searchGroupChannels:f().func.isRequired,setModalSearchTerm:f().func.isRequired}).isRequired});const oe=(0,r.connect)((()=>{const e=(0,c.uZ)();return(t,s)=>{var r;const a=(0,c.rc)(t);let n;s.isExistingChannel&&(n=(0,c.OX)(t));const i=(0,o.iE)(t).RestrictDirectMessage,u=t.views.search.modalSearch;let d;d=u?"any"===i?e(t,u,!1):(0,c.lo)(t,u,!1):"any"===i?(0,c.cp)(t):(0,c.fv)(t);const m=(0,l.kA)(t),h=(0,c.S1)(t)||{total_users_count:0};return{currentTeamId:null==m?void 0:m.id,currentTeamName:null==m?void 0:m.name,searchTerm:u,users:d,currentChannelMembers:n,currentUserId:a,restrictDirectMessage:i,totalCount:null!==(r=h.total_users_count)&&void 0!==r?r:0}}}),(function(e){return{actions:(0,a.bindActionCreators)({getProfiles:i.cp,getProfilesInTeam:i.gV,loadProfilesMissingStatus:d.sf,getTotalUsersStats:i.S1,loadStatusesForProfilesList:d.xO,loadProfilesForGroupChannels:m.Tg,openDirectChannelToUserId:u.Pn,openGroupChannelToUserIds:u.iU,searchProfiles:i.t6,searchGroupChannels:n.PP,setModalSearchTerm:h.Gl},e)}}))(ie)}}]);
//# sourceMappingURL=4036.f15e424fb933d6867fbd.js.map